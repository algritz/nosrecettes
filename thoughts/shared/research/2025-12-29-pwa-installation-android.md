---
date: 2025-12-30T00:17:16+0000
researcher: Claude Code
git_commit: a5683d802f2682ae74ebb2f809abd234e3c1bbd5
branch: main
repository: algritz/nosrecettes
topic: "PWA Installation Not Prompting on Android"
tags: [research, codebase, pwa, manifest, android, icons, deployment]
status: complete
last_updated: 2025-12-29
last_updated_by: Claude Code
---

# Research: PWA Installation Not Prompting on Android

**Date**: 2025-12-30T00:17:16+0000
**Researcher**: Claude Code
**Git Commit**: a5683d802f2682ae74ebb2f809abd234e3c1bbd5
**Branch**: main
**Repository**: algritz/nosrecettes

## Research Question
Why is the nosrecettes.ca website no longer prompting for installation as a PWA (Progressive Web App) on Android devices?

## Summary
The PWA installation prompt is failing on Android because the icon files referenced in the manifest.json are missing from the deployed site. The manifest references `/icon-192.png` and `/icon-512.png`, but the actual files are named `icon-192x192.png` and `icon-512x512.png` in the project root and are never copied to the dist folder during the build process.

## Detailed Findings

### PWA Manifest Configuration
The manifest is dynamically generated by the build process ([scripts/generate-manifest.js](scripts/generate-manifest.js)):
- The script generates [public/manifest.json](public/manifest.json) with icon paths: `/icon-192.png`, `/icon-512.png`
- Screenshot paths: `/screenshot-wide.png`, `/screenshot-narrow.png`
- The manifest is correctly deployed and accessible at https://nosrecettes.ca/manifest.json (returns 200 OK)

### Missing Icon Files
**The Core Problem**: Icon files referenced in manifest.json do not exist on the deployed site.

Testing production URLs:
- https://nosrecettes.ca/icon-192.png → **404 Not Found**
- https://nosrecettes.ca/icon-512.png → **404 Not Found**
- https://nosrecettes.ca/screenshot-wide.png → **404 Not Found**
- https://nosrecettes.ca/screenshot-narrow.png → **404 Not Found**

Actual icon files in the project:
- `/icon-192x192.png` (exists in project root)
- `/icon-512x512.png` (exists in project root)
- `/favicon-16x16.png` (exists in project root)
- `/favicon-32x32.png` (exists in project root)

**Filename Mismatch**: The manifest references `icon-192.png` but the file is named `icon-192x192.png`.

### Build Process Analysis
The build process ([vite.config.ts:16-38](vite.config.ts#L16-L38)) uses `vite-plugin-pwa`:
```typescript
VitePWA({
  registerType: 'autoUpdate',
  includeAssets: ['favicon.ico', 'apple-touch-icon.png', 'mask-icon.svg'],
  manifest: false, // Use existing manifest.json generated by build:seo
  workbox: {
    globPatterns: ['**/*.{js,css,html,ico,png,svg,woff,woff2}'],
    maximumFileSizeToCacheInBytes: 7 * 1024 * 1024,
    navigateFallback: '/index.html',
    // ...
  }
})
```

The `includeAssets` configuration only explicitly lists:
- `favicon.ico`
- `apple-touch-icon.png`
- `mask-icon.svg`

The icon files are NOT in the `public/` directory where Vite automatically copies files to `dist/`. They are in the project root.

### Service Worker Status
Service worker is correctly deployed:
- https://nosrecettes.ca/sw.js → **200 OK**
- Service worker is minified and includes workbox precaching
- [dist/sw.js:1](dist/sw.js#L1) shows the service worker is generated with precache manifest

### HTML Manifest Link
The [index.html:60](index.html#L60) correctly references the manifest:
```html
<link rel="manifest" href="/manifest.json" />
```

### PWA Installation Criteria
For Android Chrome to show the PWA install prompt, all these conditions must be met:
1. ✅ Served over HTTPS (nosrecettes.ca uses HTTPS)
2. ✅ Has a valid manifest.json file (exists and is valid JSON)
3. ✅ Has a service worker registered (sw.js exists and is functional)
4. ❌ **Manifest icons are accessible** (FAILING - icons return 404)
5. ✅ Has a valid start_url
6. ✅ Has display: "standalone" or "fullscreen"

## Code References
- [vite.config.ts:16-38](vite.config.ts#L16-L38) - VitePWA configuration
- [scripts/generate-manifest.js:28-46](scripts/generate-manifest.js#L28-L46) - Icon paths in manifest generation
- [scripts/generate-manifest.js:47-62](scripts/generate-manifest.js#L47-L62) - Screenshot paths in manifest generation
- [public/manifest.json:18-36](public/manifest.json#L18-L36) - Current manifest icon definitions
- [index.html:60](index.html#L60) - Manifest link tag
- [.github/workflows/deploy.yml:33-37](.github/workflows/deploy.yml#L33-L37) - Build and deployment process

## Root Causes

1. **Filename Mismatch**: The manifest generator ([scripts/generate-manifest.js:35](scripts/generate-manifest.js#L35)) creates paths for `/icon-192.png` and `/icon-512.png`, but the actual files are named `icon-192x192.png` and `icon-512x512.png`.

2. **Files Not in Public Directory**: Icon files are in the project root (`/icon-192x192.png`) rather than in the `public/` directory where Vite automatically copies assets to `dist/`.

3. **Missing from includeAssets**: The VitePWA plugin's `includeAssets` configuration ([vite.config.ts:18](vite.config.ts#L18)) doesn't include the icon files, and they're not being copied by any other mechanism.

4. **No Screenshot Files**: The manifest references screenshot files that don't exist anywhere in the project.

## Architecture Documentation

### PWA Build Flow
1. `npm run build:seo` runs [scripts/build-seo.js](scripts/build-seo.js)
2. [scripts/build-seo.js:34-39](scripts/build-seo.js#L34-L39) calls `generateManifest()`
3. Manifest is written to [public/manifest.json](public/manifest.json)
4. `vite build` runs with VitePWA plugin
5. VitePWA processes the manifest and generates service worker
6. Assets from `public/` are copied to `dist/`
7. **PROBLEM**: Icon files in root are never copied to `dist/`

### Service Worker Registration
The application does NOT explicitly register the service worker in [src/main.tsx](src/main.tsx). The VitePWA plugin with `registerType: 'autoUpdate'` handles this automatically through injected code.

## Open Questions
1. Were these icon files ever in the correct location, or is this a longstanding issue?
2. Were the screenshot files (`screenshot-wide.png`, `screenshot-narrow.png`) ever created?
3. When did the PWA installation last work on Android?
